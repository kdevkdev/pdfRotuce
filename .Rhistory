theme(axis.text.x = element_text(angle = 90, vjust = 0.5),legend.box="vertical", legend.position = "none")
dp_inf = bandify_boot_point(scenario_optimistic$point$db_uvas_inf,
scenario_optimistic$boots$db_uvas_inf,
svars =  c("type", "sex", "year"),vvar = "infval")
dp_inf[type == "counterfactual"]$type = "Counterfactual"
dp_inf[type == "observed"]$type = "Observed"
dp_inf$type = factor(dp_inf$type, c("Observed", "Counterfactual"))
p3 = ggplot(dp_inf[sex == "total"])+
ylab("Exposure value")+
xlab("Year turning 29")+
geom_ribbon(mapping = aes(x = year, ymin = val_li, ymax = val_ui, linetype = type, fill = sex), alpha = 0.2)+
geom_line(mapping = aes(x = year, y = infval, linetype = type, color = sex))+
guides( linetype = guide_legend(title = "Type"),color = "none", fill = "none")+
scale_x_continuous(breaks = seq(from = min(dp_inf$year), to = 2034, by = 2), limits = c(1996, 2034))+
#geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2007.5, 2016.5), alpha = 1, color = colors7[7])+# intervention limits
geom_vline(xintercept = c(2024), alpha = 1, color = colors7[6])+# intervention limits
scale_alpha_manual(values = c(0.3, 1))+
ggthemes::theme_hc()+
ggtitle("Scenario optimistic")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5),legend.box="horizontal", legend.direction = "horizontal")
setkey(dp_np, "year_when30")
dp_np_ma = dp_np[, .(year_when30, value = frollmean(value,4))]
p4 = ggplot(dp_np_ma[year_when30 >= 1996 & year_when30 <= 2022])+
ylab("Proportion")+
xlab("Year turning 29")+
#geom_ribbon(mapping = aes(x = year, ymin = val_li, ymax = val_ui, linetype = type, fill = sex), alpha = 0.2)+
geom_line(mapping = aes(x = year_when30-1, y = value))+
guides(col  = guide_legend(title = "Variable"), linetype = guide_legend(title = "Type"))+
scale_x_continuous(breaks = seq(from = min(dp_inf$year), to = max(dp_inf$year), by = 2), limits = c(1984, 1996))+#limits = c( min(dp_inf$year), max(dp_inf$year)))+
geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2007.5, 2016.5), alpha = 1, color = colors7[7])+# intervention limits
geom_vline(xintercept = c(2024), alpha = 1, color = colors7[6])+# intervention limits
scale_alpha_manual(values = c(0.3, 1))+
ggthemes::theme_hc()+
ggtitle("Moving average former NEET proportion")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5),legend.box="horizontal", legend.direction = "horizontal")
pth_inf = p3
cowplot::plot_grid(p1,p2, p3,p4, nrow = 4, rel_heights = c(1,1,1.5,1), hjust = 0, label_x = 0.15, label_y = 1.05)
dp_inf = bandify_boot_point(scenario_unemp_only$point$db_uvas_inf,
scenario_unemp_only$boots$db_uvas_inf,
svars =  c("type", "sex", "year"),vvar = "infval")
dp_inf[type == "counterfactual"]$type = "Counterfactual"
dp_inf[type == "observed"]$type = "Observed"
dp_inf$type = factor(dp_inf$type, c("Observed", "Counterfactual"))
p1 = ggplot(dp_inf[sex == "total"])+
ylab("Exposure value")+
xlab("Year turning 29")+
geom_ribbon(mapping = aes(x = year, ymin = val_li, ymax = val_ui, linetype = type, fill = sex), alpha = 0.2)+
geom_line(mapping = aes(x = year, y = infval, linetype = type, color = sex))+
guides(col  = guide_legend(title = "Variable"), linetype = guide_legend(title = "Type"),color = "none", fill = "none")+
scale_x_continuous(breaks = seq(from = min(dp_inf$year), to = max(dp_inf$year), by = 2),limits = c(1996, 2034))+
geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2007.5, 2016.5), alpha = 1, color = colors7[7])+# intervention limits
geom_vline(xintercept = c(2024), alpha = 1, color = colors7[6])+# intervention limits
scale_alpha_manual(values = c(0.3, 1))+
ggtitle("Scenario unemployment only")+
ggthemes::theme_hc()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5),legend.box="vertical", legend.position = "none")
dp_inf = bandify_boot_point(scenario_cautious$point$db_uvas_inf,
scenario_cautious$boots$db_uvas_inf,
svars =  c("type", "sex", "year"),vvar = "infval")
dp_inf[type == "counterfactual"]$type = "Counterfactual"
dp_inf[type == "observed"]$type = "Observed"
dp_inf$type = factor(dp_inf$type, c("Observed", "Counterfactual"))
p2 = ggplot(dp_inf[sex == "total"])+
ylab("Exposure value")+
xlab("Year turning 29")+
geom_ribbon(mapping = aes(x = year, ymin = val_li, ymax = val_ui, linetype = type, fill = sex), alpha = 0.2)+
geom_line(mapping = aes(x = year, y = infval, linetype = type, color = sex))+
guides(col  = guide_legend(title = "Variable"), linetype = guide_legend(title = "Type"),color = "none", fill = "none")+
scale_x_continuous(breaks = seq(from = min(dp_inf$year), to = max(dp_inf$year), by = 2),limits = c(1996, 2034))+
geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2007.5, 2016.5), alpha = 1, color = colors7[7])+# intervention limits
geom_vline(xintercept = c(2024), alpha = 1, color = colors7[6])+# intervention limits
scale_alpha_manual(values = c(0.3, 1))+
ggtitle("Scenario cautious")+
ggthemes::theme_hc()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5),legend.box="vertical", legend.position = "none")
dp_inf = bandify_boot_point(scenario_optimistic$point$db_uvas_inf,
scenario_optimistic$boots$db_uvas_inf,
svars =  c("type", "sex", "year"),vvar = "infval")
dp_inf[type == "counterfactual"]$type = "Counterfactual"
dp_inf[type == "observed"]$type = "Observed"
dp_inf$type = factor(dp_inf$type, c("Observed", "Counterfactual"))
p3 = ggplot(dp_inf[sex == "total"])+
ylab("Exposure value")+
xlab("Year turning 29")+
geom_ribbon(mapping = aes(x = year, ymin = val_li, ymax = val_ui, linetype = type, fill = sex), alpha = 0.2)+
geom_line(mapping = aes(x = year, y = infval, linetype = type, color = sex))+
guides( linetype = guide_legend(title = "Type"),color = "none", fill = "none")+
scale_x_continuous(breaks = seq(from = min(dp_inf$year), to = 2034, by = 2), limits = c(1996, 2034))+
#geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2007.5, 2016.5), alpha = 1, color = colors7[7])+# intervention limits
geom_vline(xintercept = c(2024), alpha = 1, color = colors7[6])+# intervention limits
scale_alpha_manual(values = c(0.3, 1))+
ggthemes::theme_hc()+
ggtitle("Scenario optimistic")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5),legend.box="horizontal", legend.direction = "horizontal")
setkey(dp_np, "year_when30")
dp_np_ma = dp_np[, .(year_when30, value = frollmean(value,4))]
p4 = ggplot(dp_np_ma[year_when30 >= 1996 & year_when30 <= 2022])+
ylab("Proportion")+
xlab("Year turning 29")+
#geom_ribbon(mapping = aes(x = year, ymin = val_li, ymax = val_ui, linetype = type, fill = sex), alpha = 0.2)+
geom_line(mapping = aes(x = year_when30-1, y = value))+
guides(col  = guide_legend(title = "Variable"), linetype = guide_legend(title = "Type"))+
scale_x_continuous(breaks = seq(from = min(dp_inf$year), to = max(dp_inf$year), by = 2), limits = c(1996, 2034))+#limits = c( min(dp_inf$year), max(dp_inf$year)))+
geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2007.5, 2016.5), alpha = 1, color = colors7[7])+# intervention limits
geom_vline(xintercept = c(2024), alpha = 1, color = colors7[6])+# intervention limits
scale_alpha_manual(values = c(0.3, 1))+
ggthemes::theme_hc()+
ggtitle("Moving average former NEET proportion")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5),legend.box="horizontal", legend.direction = "horizontal")
pth_inf = p3
cowplot::plot_grid(p1,p2, p3,p4, nrow = 4, rel_heights = c(1,1,1.5,1), hjust = 0, label_x = 0.15, label_y = 1.05)
dp_inf = bandify_boot_point(scenario_unemp_only$point$db_uvas_inf,
scenario_unemp_only$boots$db_uvas_inf,
svars =  c("type", "sex", "year"),vvar = "infval")
dp_inf[type == "counterfactual"]$type = "Counterfactual"
dp_inf[type == "observed"]$type = "Observed"
dp_inf$type = factor(dp_inf$type, c("Observed", "Counterfactual"))
p1 = ggplot(dp_inf[sex == "total"])+
ylab("Exposure value")+
xlab("Year turning 29")+
geom_ribbon(mapping = aes(x = year, ymin = val_li, ymax = val_ui, linetype = type, fill = sex), alpha = 0.2)+
geom_line(mapping = aes(x = year, y = infval, linetype = type, color = sex))+
guides(col  = guide_legend(title = "Variable"), linetype = guide_legend(title = "Type"),color = "none", fill = "none")+
scale_x_continuous(breaks = seq(from = min(dp_inf$year), to = max(dp_inf$year), by = 2),limits = c(1996, 2034))+
geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2007.5, 2016.5), alpha = 1, color = colors7[7])+# intervention limits
geom_vline(xintercept = c(2024), alpha = 1, color = colors7[6])+# intervention limits
scale_alpha_manual(values = c(0.3, 1))+
ggtitle("Scenario unemployment only")+
ggthemes::theme_hc()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5),legend.box="vertical", legend.position = "none")
dp_inf = bandify_boot_point(scenario_cautious$point$db_uvas_inf,
scenario_cautious$boots$db_uvas_inf,
svars =  c("type", "sex", "year"),vvar = "infval")
dp_inf[type == "counterfactual"]$type = "Counterfactual"
dp_inf[type == "observed"]$type = "Observed"
dp_inf$type = factor(dp_inf$type, c("Observed", "Counterfactual"))
p2 = ggplot(dp_inf[sex == "total"])+
ylab("Exposure value")+
xlab("Year turning 29")+
geom_ribbon(mapping = aes(x = year, ymin = val_li, ymax = val_ui, linetype = type, fill = sex), alpha = 0.2)+
geom_line(mapping = aes(x = year, y = infval, linetype = type, color = sex))+
guides(col  = guide_legend(title = "Variable"), linetype = guide_legend(title = "Type"),color = "none", fill = "none")+
scale_x_continuous(breaks = seq(from = min(dp_inf$year), to = max(dp_inf$year), by = 2),limits = c(1996, 2034))+
geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2007.5, 2016.5), alpha = 1, color = colors7[7])+# intervention limits
geom_vline(xintercept = c(2024), alpha = 1, color = colors7[6])+# intervention limits
scale_alpha_manual(values = c(0.3, 1))+
ggtitle("Scenario cautious")+
ggthemes::theme_hc()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5),legend.box="vertical", legend.position = "none")
dp_inf = bandify_boot_point(scenario_optimistic$point$db_uvas_inf,
scenario_optimistic$boots$db_uvas_inf,
svars =  c("type", "sex", "year"),vvar = "infval")
dp_inf[type == "counterfactual"]$type = "Counterfactual"
dp_inf[type == "observed"]$type = "Observed"
dp_inf$type = factor(dp_inf$type, c("Observed", "Counterfactual"))
p3 = ggplot(dp_inf[sex == "total"])+
ylab("Exposure value")+
xlab("Year turning 29")+
geom_ribbon(mapping = aes(x = year, ymin = val_li, ymax = val_ui, linetype = type, fill = sex), alpha = 0.2)+
geom_line(mapping = aes(x = year, y = infval, linetype = type, color = sex))+
guides( linetype = guide_legend(title = "Type"),color = "none", fill = "none")+
scale_x_continuous(breaks = seq(from = min(dp_inf$year), to = 2034, by = 2), limits = c(1996, 2034))+
#geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2007.5, 2016.5), alpha = 1, color = colors7[7])+# intervention limits
geom_vline(xintercept = c(2024), alpha = 1, color = colors7[6])+# intervention limits
scale_alpha_manual(values = c(0.3, 1))+
ggthemes::theme_hc()+
ggtitle("Scenario optimistic")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5),legend.box="horizontal", legend.direction = "horizontal")
setkey(dp_np, "year_when30")
dp_np_ma = dp_np[, .(year_when30, value = frollmean(value,4))]
p4 = ggplot(dp_np_ma[year_when30 >= 1996 & year_when30 <= 2022])+
ylab("Proportion")+
xlab("Year turning 29")+
#geom_ribbon(mapping = aes(x = year, ymin = val_li, ymax = val_ui, linetype = type, fill = sex), alpha = 0.2)+
geom_line(mapping = aes(x = year_when30-1, y = value))+
guides(col  = guide_legend(title = "Variable"), linetype = guide_legend(title = "Type"))+
scale_x_continuous(breaks = seq(from = min(dp_inf$year), to = max(dp_inf$year), by = 2), limits = c(1996, 2034))+#limits = c( min(dp_inf$year), max(dp_inf$year)))+
geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2007.5, 2016.5), alpha = 1, color = colors7[7])+# intervention limits
geom_vline(xintercept = c(2024), alpha = 1, color = colors7[6])+# intervention limits
scale_alpha_manual(values = c(0.3, 1))+
ggthemes::theme_hc()+
ggtitle("Moving average former NEET proportion")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5),legend.box="horizontal", legend.direction = "horizontal")
pth_inf = p3
#cowplot::plot_grid(p1,p2, p3,p4, nrow = 4, rel_heights = c(1,1,1.5,1), hjust = 0, label_x = 0.15, label_y = 1.05)
cowplot::plot_grid(p1,p2, p3, nrow = 3, rel_heights = c(1,1,1.5), hjust = 0, label_x = 0.15, label_y = 1.05)
dp_inf = bandify_boot_point(scenario_unemp_only$point$db_uvas_inf,
scenario_unemp_only$boots$db_uvas_inf,
svars =  c("type", "sex", "year"),vvar = "infval")
dp_inf[type == "counterfactual"]$type = "Counterfactual"
dp_inf[type == "observed"]$type = "Observed"
dp_inf$type = factor(dp_inf$type, c("Observed", "Counterfactual"))
p1 = ggplot(dp_inf[sex == "total"])+
ylab("Exposure value")+
xlab("Year turning 29")+
geom_ribbon(mapping = aes(x = year, ymin = val_li, ymax = val_ui, linetype = type, fill = sex), alpha = 0.2)+
geom_line(mapping = aes(x = year, y = infval, linetype = type, color = sex))+
guides(col  = guide_legend(title = "Variable"), linetype = guide_legend(title = "Type"),color = "none", fill = "none")+
scale_x_continuous(breaks = seq(from = min(dp_inf$year), to = max(dp_inf$year), by = 2),limits = c(1996, 2034))+
geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2007.5, 2016.5), alpha = 1, color = colors7[7])+# intervention limits
geom_vline(xintercept = c(2024), alpha = 1, color = colors7[6])+# intervention limits
scale_alpha_manual(values = c(0.3, 1))+
ggtitle("Scenario unemployment only")+
ggthemes::theme_hc()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5),legend.box="vertical", legend.position = "none")
dp_inf = bandify_boot_point(scenario_cautious$point$db_uvas_inf,
scenario_cautious$boots$db_uvas_inf,
svars =  c("type", "sex", "year"),vvar = "infval")
dp_inf[type == "counterfactual"]$type = "Counterfactual"
dp_inf[type == "observed"]$type = "Observed"
dp_inf$type = factor(dp_inf$type, c("Observed", "Counterfactual"))
p2 = ggplot(dp_inf[sex == "total"])+
ylab("Exposure value")+
xlab("Year turning 29")+
geom_ribbon(mapping = aes(x = year, ymin = val_li, ymax = val_ui, linetype = type, fill = sex), alpha = 0.2)+
geom_line(mapping = aes(x = year, y = infval, linetype = type, color = sex))+
guides(col  = guide_legend(title = "Variable"), linetype = guide_legend(title = "Type"),color = "none", fill = "none")+
scale_x_continuous(breaks = seq(from = min(dp_inf$year), to = max(dp_inf$year), by = 2),limits = c(1996, 2034))+
geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2007.5, 2016.5), alpha = 1, color = colors7[7])+# intervention limits
geom_vline(xintercept = c(2024), alpha = 1, color = colors7[6])+# intervention limits
scale_alpha_manual(values = c(0.3, 1))+
ggtitle("Scenario cautious")+
ggthemes::theme_hc()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5),legend.box="vertical", legend.position = "none")
dp_inf = bandify_boot_point(scenario_optimistic$point$db_uvas_inf,
scenario_optimistic$boots$db_uvas_inf,
svars =  c("type", "sex", "year"),vvar = "infval")
dp_inf[type == "counterfactual"]$type = "Counterfactual"
dp_inf[type == "observed"]$type = "Observed"
dp_inf$type = factor(dp_inf$type, c("Observed", "Counterfactual"))
p3 = ggplot(dp_inf[sex == "total"])+
ylab("Exposure value")+
xlab("Year turning 29")+
geom_ribbon(mapping = aes(x = year, ymin = val_li, ymax = val_ui, linetype = type, fill = sex), alpha = 0.2)+
geom_line(mapping = aes(x = year, y = infval, linetype = type, color = sex))+
guides( linetype = guide_legend(title = "Type"),color = "none", fill = "none")+
scale_x_continuous(breaks = seq(from = min(dp_inf$year), to = 2034, by = 2), limits = c(1996, 2034))+
#geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2007.5, 2016.5), alpha = 1, color = colors7[7])+# intervention limits
geom_vline(xintercept = c(2024), alpha = 1, color = colors7[6])+# intervention limits
scale_alpha_manual(values = c(0.3, 1))+
ggthemes::theme_hc()+
ggtitle("Scenario optimistic")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5),legend.box="horizontal", legend.direction = "horizontal")
setkey(dp_np, "year_when30")
dp_np_ma = dp_np[, .(year_when30, value = frollmean(value,4))]
p4 = ggplot(dp_np_ma[year_when30 >= 1996 & year_when30 <= 2022])+
ylab("Proportion")+
xlab("Year turning 29")+
#geom_ribbon(mapping = aes(x = year, ymin = val_li, ymax = val_ui, linetype = type, fill = sex), alpha = 0.2)+
geom_line(mapping = aes(x = year_when30-1, y = value))+
guides(col  = guide_legend(title = "Variable"), linetype = guide_legend(title = "Type"))+
scale_x_continuous(breaks = seq(from = min(dp_inf$year), to = max(dp_inf$year), by = 2), limits = c(1996, 2034))+#limits = c( min(dp_inf$year), max(dp_inf$year)))+
geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2007.5, 2016.5), alpha = 1, color = colors7[7])+# intervention limits
geom_vline(xintercept = c(2024), alpha = 1, color = colors7[6])+# intervention limits
scale_alpha_manual(values = c(0.3, 1))+
ggthemes::theme_hc()+
ggtitle("Moving average former NEET proportion")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5),legend.box="horizontal", legend.direction = "horizontal")
pth_inf = p3
#cowplot::plot_grid(p1,p2, p3,p4, nrow = 4, rel_heights = c(1,1,1.5,1), hjust = 0, label_x = 0.15, label_y = 1.05)
cowplot::plot_grid(p1,p2, p3, nrow = 3, rel_heights = c(1,1,1.4), hjust = 0, label_x = 0.15, label_y = 1.05)
prop_plot = function (base_scenario, title, leg = T){
dp_uvsprop = base_scenario$boots$db_preddata[, .(bi = boot_ind,
prediction_cf = prediction_cf,
retrodiction = retrodiction,
year = as.double(year_when30))] |> melt(id.vars = c("bi", "year"), variable.factor = F)
# only take below 2022 as rest is not observed at age 30
dp_uvobs_boot = base_scenario$boots$db_preddata[year_when30 <= 2022, .(bi = boot_ind,
observerd = obs,
year = as.double(year_when30))] |> melt(id.vars = c("bi", "year"), variable.factor  = F)
dp_uvobs = base_scenario$point$db_preddata[year_when30 <= 2022, .(
observerd = obs,
year = as.double(year_when30))] |> melt(id.vars = c("year"), variable.factor  = F)
dp_uvpred  = base_scenario$point$db_preddata[, .(
retrodiction = retrodiction,
prediction_cf = prediction_cf,
year = as.double(year_when30))] |> melt(id.vars = c("year"), variable.factor = F)
dp_lines = rbind(dp_uvpred, dp_uvpred, dp_uvobs)
dpr = rbind(dp_uvsprop, dp_uvobs_boot)[, .(ymax = quantile(value, probs = 0.025, na.rm=T), ymin = quantile(value,probs = 0.975, na.rm = T)), by = c("variable", "year")]
brks = c("Observed" = "observerd", "Predicted" =  "prediction_cf", "Retrodicted" =  "retrodiction")
brkv = brkvf = colors7[c(1,2,3,4)]
brkvf[1] = colorspace::lighten(brkv[1], 0.8)
dp_lines$ltype = "Factual"
dp_lines[variable == "prediction_cf"]$ltype = "Counterfactual"
dp_lines$ltype = factor(dp_lines$ltype, c("Factual", "Counterfactual"))
#dpr$year
p_pred_uvas = ggplot(dpr)+
ylab(NULL)+
xlab(NULL)+
scale_x_continuous(breaks = seq(from = min(dpr$year), to = max(dpr$year), by = 2))+
scale_y_continuous(limits  = c(0,0.7))+
geom_ribbon(mapping = aes(ymin = ymin, ymax= ymax, fill = variable, x = year, alpha = variable),
show.legend = F)+
geom_line(data = dp_lines, mapping = aes(x = year, y = value, color = variable, linetype = ltype))+
scale_alpha_manual(values = c(0.6,0.2, 0.15))+
scale_fill_manual(breaks = brks, values = brkvf, labels = names(brks))+
scale_colour_manual(breaks = brks, values = brkv, labels = names(brks))+
guides(col = "none",linetype = guide_legend(title = "Type"))+ #guide_legend(title = "Estimate"),linetype = FALSE)+
#geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2007.5, 2016.5), alpha = 1, color = colors7[7])+# intervention limits
geom_vline(xintercept = c(2024), alpha = 1, color = colors7[6])+# intervention limits
ggtitle(title)+
ggrepel::geom_text_repel(data = data.frame(x = 1996, y = 0.29),
mapping = aes(x= x, y= y), color = colors7[1],
label = "Observed", nudge_x = -1, nudge_y = 0.23)+
ggrepel::geom_label_repel(data = data.frame(x = 2028, y = 0.44),
mapping = aes(x= x, y= y), color = colors7[2], label.size = 0,
label = "Counterfactual", nudge_x = 4.2, nudge_y = 0.14)+
ggrepel::geom_text_repel(data = data.frame(x = 2028, y = 0.28),
mapping = aes(x= x, y= y), color = colors7[3],
label = "Factual", nudge_x = 3, nudge_y = -0.15)+
ggthemes::theme_hc()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5),legend.position = "bottom",
panel.ontop=F, panel.background = element_rect(fill = NA), text = element_text(size=18))
if(!leg){
p_pred_uvas = p_pred_uvas + theme(legend.position =  "none")+ylab(NULL)
}
dp_uvsprop_diff = base_scenario$boots$db_preddata[, .(bi = boot_ind,
diff = prediction_cf - retrodiction,
year = as.double(year_when30))] |> melt(id.vars = c("bi", "year"), variable.factor = F)
dp_bc_diff = base_scenario$point$db_preddata[, .(
diff = prediction_cf - retrodiction,
year = as.double(year_when30))] |> melt(id.vars = c( "year"), variable.factor  = F)
dpr_diff = dp_uvsprop_diff[, .(ymax = quantile(value, probs = 0.025, na.rm=T), ymin = quantile(value,probs = 0.975, na.rm = T)), by = c("variable", "year")]
p_pred_uvas_diff = ggplot(dpr_diff)+
ylab(NULL)+
xlab("Year turning 30")+
scale_y_continuous(limits  = c(-0.05, 0.22))+
scale_x_continuous(breaks = seq(from = min(dpr_diff$year), to = max(dpr_diff$year), by = 4))+
geom_ribbon(mapping = aes(ymin = ymin, ymax= ymax, fill = variable, x = year),
alpha = 0.3, show.legend = F)+
geom_line(data = dp_bc_diff, mapping = aes(x = year, y = value, color = variable))+
scale_fill_manual(values = colors7[7])+
scale_colour_manual(breaks = "diff", values = colors7[7])+
guides(col = guide_legend(title = "Estimate"))+
ggthemes::theme_hc()+
#geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2007.5, 2016.5), alpha = 1, color = colors7[7])+# intervention limits
geom_vline(xintercept = c(2024), alpha = 1, color = colors7[6])+# intervention limits
theme(axis.text.x = element_text(angle = 90, vjust = 0.5), legend.position = "none", text = element_text(size=18))
if(!leg){
p_pred_uvas_diff = p_pred_uvas_diff + theme(legend.position =  "none")+ylab(NULL)
}
leg_top = cowplot::get_legend(p_pred_uvas)
#cowplot::plot_grid(ncol = 1, p_pred_uvas, p_pred_uvas_diff, rel_heights = c(0.6,0.4))
list(l1 = list(p_pred_uvas+theme(legend.position = "none"), p_pred_uvas_diff), leg = leg_top)
}
p1 = prop_plot(scenario_unemp_only, title = "Scenario unemployment only")
p2 = prop_plot(scenario_cautious, title = "Scenario cautious")
p3 = prop_plot(scenario_optimistic, title = "Scenario optimistic")
# p1 = prop_plot(scenario_o_sm1, title = "Scenario optimistic shift  1")
# p2 = prop_plot(scenario_o_sm2, title = "Scenario optimistic shift  2")
# p3 = prop_plot(scenario_o_sm3, title = "Scenario optimistic shift  3")
pl   = list(p1$l1[[1]], p2$l1[[1]], p3$l1[[1]],
NULL, p2$leg, NULL,
p1$l1[[2]], p2$l1[[2]], p3$l1[[2]])
pth_pred = p3$l1[[1]]
pth_pred_leg = p2$leg
p_all = cowplot::plot_grid(plotlist = pl, ncol = 3, nrow = 3, rel_widths = c(1,1,1), rel_heights =c(0.5,0.15,0.45), byrow = T)
p_all
prop_plot = function (base_scenario, title, leg = T){
dp_uvsprop = base_scenario$boots$db_preddata[, .(bi = boot_ind,
prediction_cf = prediction_cf,
retrodiction = retrodiction,
year = as.double(year_when30))] |> melt(id.vars = c("bi", "year"), variable.factor = F)
# only take below 2022 as rest is not observed at age 30
dp_uvobs_boot = base_scenario$boots$db_preddata[year_when30 <= 2022, .(bi = boot_ind,
observerd = obs,
year = as.double(year_when30))] |> melt(id.vars = c("bi", "year"), variable.factor  = F)
dp_uvobs = base_scenario$point$db_preddata[year_when30 <= 2022, .(
observerd = obs,
year = as.double(year_when30))] |> melt(id.vars = c("year"), variable.factor  = F)
dp_uvpred  = base_scenario$point$db_preddata[, .(
retrodiction = retrodiction,
prediction_cf = prediction_cf,
year = as.double(year_when30))] |> melt(id.vars = c("year"), variable.factor = F)
dp_lines = rbind(dp_uvpred, dp_uvpred, dp_uvobs)
dpr = rbind(dp_uvsprop, dp_uvobs_boot)[, .(ymax = quantile(value, probs = 0.025, na.rm=T), ymin = quantile(value,probs = 0.975, na.rm = T)), by = c("variable", "year")]
brks = c("Observed" = "observerd", "Predicted" =  "prediction_cf", "Retrodicted" =  "retrodiction")
brkv = brkvf = colors7[c(1,2,3,4)]
brkvf[1] = colorspace::lighten(brkv[1], 0.8)
dp_lines$ltype = "Factual"
dp_lines[variable == "prediction_cf"]$ltype = "Counterfactual"
dp_lines$ltype = factor(dp_lines$ltype, c("Factual", "Counterfactual"))
#dpr$year
p_pred_uvas = ggplot(dpr)+
ylab(NULL)+
xlab(NULL)+
scale_x_continuous(breaks = seq(from = min(dpr$year), to = max(dpr$year), by = 2))+
scale_y_continuous(limits  = c(0,0.7))+
geom_ribbon(mapping = aes(ymin = ymin, ymax= ymax, fill = variable, x = year, alpha = variable),
show.legend = F)+
geom_line(data = dp_lines, mapping = aes(x = year, y = value, color = variable, linetype = ltype))+
scale_alpha_manual(values = c(0.6,0.2, 0.15))+
scale_fill_manual(breaks = brks, values = brkvf, labels = names(brks))+
scale_colour_manual(breaks = brks, values = brkv, labels = names(brks))+
guides(col = "none",linetype = guide_legend(title = "Type"))+ #guide_legend(title = "Estimate"),linetype = FALSE)+
#geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2007.5, 2016.5), alpha = 1, color = colors7[7])+# intervention limits
geom_vline(xintercept = c(2024), alpha = 1, color = colors7[6])+# intervention limits
ggtitle(title)+
ggrepel::geom_text_repel(data = data.frame(x = 1996, y = 0.29),
mapping = aes(x= x, y= y), color = colors7[1],
label = "Observed", nudge_x = -1, nudge_y = 0.23)+
ggrepel::geom_label_repel(data = data.frame(x = 2028, y = 0.44),
mapping = aes(x= x, y= y), color = colors7[2], label.size = 0,
label = "Counterfactual", nudge_x = 4.2, nudge_y = 0.14)+
ggrepel::geom_text_repel(data = data.frame(x = 2028, y = 0.28),
mapping = aes(x= x, y= y), color = colors7[3],
label = "Factual", nudge_x = 3, nudge_y = -0.15)+
ggthemes::theme_hc()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5),legend.position = "bottom",
panel.ontop=F, panel.background = element_rect(fill = NA), text = element_text(size=18))
if(!leg){
p_pred_uvas = p_pred_uvas + theme(legend.position =  "none")+ylab(NULL)
}
dp_uvsprop_diff = base_scenario$boots$db_preddata[, .(bi = boot_ind,
diff = prediction_cf - retrodiction,
year = as.double(year_when30))] |> melt(id.vars = c("bi", "year"), variable.factor = F)
dp_bc_diff = base_scenario$point$db_preddata[, .(
diff = prediction_cf - retrodiction,
year = as.double(year_when30))] |> melt(id.vars = c( "year"), variable.factor  = F)
dpr_diff = dp_uvsprop_diff[, .(ymax = quantile(value, probs = 0.025, na.rm=T), ymin = quantile(value,probs = 0.975, na.rm = T)), by = c("variable", "year")]
p_pred_uvas_diff = ggplot(dpr_diff)+
ylab(NULL)+
xlab("Year turning 30")+
scale_y_continuous(limits  = c(-0.05, 0.22))+
scale_x_continuous(breaks = seq(from = min(dpr_diff$year), to = max(dpr_diff$year), by = 4))+
geom_ribbon(mapping = aes(ymin = ymin, ymax= ymax, fill = variable, x = year),
alpha = 0.3, show.legend = F)+
geom_line(data = dp_bc_diff, mapping = aes(x = year, y = value, color = variable))+
scale_fill_manual(values = colors7[7])+
scale_colour_manual(breaks = "diff", values = colors7[7])+
guides(col = guide_legend(title = "Estimate"))+
ggthemes::theme_hc()+
#geom_vline(xintercept = c(2010, 2018), alpha = 0.8, color = colors7[4])+# saez limits
geom_vline(xintercept = c(2007.5, 2016.5), alpha = 1, color = colors7[7])+# intervention limits
geom_vline(xintercept = c(2024), alpha = 1, color = colors7[6])+# intervention limits
theme(axis.text.x = element_text(angle = 90, vjust = 0.5), legend.position = "none", text = element_text(size=18))
if(!leg){
p_pred_uvas_diff = p_pred_uvas_diff + theme(legend.position =  "none")+ylab(NULL)
}
leg_top = cowplot::get_legend(p_pred_uvas)
#cowplot::plot_grid(ncol = 1, p_pred_uvas, p_pred_uvas_diff, rel_heights = c(0.6,0.4))
list(l1 = list(p_pred_uvas+theme(legend.position = "none"), p_pred_uvas_diff), leg = leg_top)
}
p1 = prop_plot(scenario_unemp_only, title = "Scenario unemployment only")
p2 = prop_plot(scenario_cautious, title = "Scenario cautious")
p3 = prop_plot(scenario_optimistic, title = "Scenario optimistic")
# p1 = prop_plot(scenario_o_sm1, title = "Scenario optimistic shift  1")
# p2 = prop_plot(scenario_o_sm2, title = "Scenario optimistic shift  2")
# p3 = prop_plot(scenario_o_sm3, title = "Scenario optimistic shift  3")
pl   = list(p1$l1[[1]], p2$l1[[1]], p3$l1[[1]],
NULL, p2$leg, NULL,
p1$l1[[2]], p2$l1[[2]], p3$l1[[2]])
pth_pred = p3$l1[[1]]
pth_pred_leg = p2$leg
p_all = cowplot::plot_grid(plotlist = pl, ncol = 3, nrow = 3, rel_widths = c(1,1,1), rel_heights =c(0.5,0.05,0.45), byrow = T)
p_all
rmarkdown::render("cea_neet_2008_20240517_hesg.Rmd", output_dir = "cea/wordout/")
rmarkdown::render("cea_neet_2008_20240517_hesg.Rmd", output_dir = "cea/wordout/")
rmarkdown::render("cea_neet_2008_20240517_hesg.Rmd", output_dir = "cea/wordout/")
rmarkdown::render("cea_neet_2008_20240517_hesg.Rmd", output_dir = "cea/wordout/")
devtools::load_all(".")
build("../t7", overwrite = "build")
draft("../t7", overwrite = "build")
build("../t7")
devtools::load_all(".")
build("../t7")
doc_summar
doc_summar
doc_summar$mrkdwn
doc_summar$text
devtools::install_github("https://github.com/kdevkdev/officer/")
build("../t7")
doc_summar$text
officer::docx_summary()
officer::docx_summary
library(officer)
officer::docx_summary
devtools::install_github("https://github.com/kdevkdev/officer/")
devtools::install_github("https://github.com/kdevkdev/officer/", force =T)
officer::docx_summary
devtools::install_github("https://github.com/kdevkdev/officer")
?devtools::install_github()
devtools::install_github(repo = "kdevkdev/officer")
devtools::install_github(repo = "kdevkdev/officer", ref = "f8afee1")
devtools::install_github(repo = "kdevkdev/officer", ref = "master")
officer::doc_summary
officer::doc_sum
officer::docx_summary
devtools::load_all(".")
build("../t7")
doc_summar$text
